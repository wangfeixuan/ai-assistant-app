# 📱 本地通知弹窗问题排查指南

## 🎯 问题描述
本地通知应该像微信消息一样在iPhone顶部弹出通知横幅，而不是只在应用内部显示。

## 🔍 排查步骤

### 1. 检查iPhone通知权限设置
```
iPhone设置 → 通知 → 你的应用名称 → 确保以下选项已开启：
✅ 允许通知
✅ 横幅样式：选择"持续"或"临时"
✅ 声音
✅ 标记
✅ 在锁定屏幕上显示
✅ 在历史记录中显示
✅ 在通知中心显示
```

### 2. 测试不同场景下的通知

#### 🔸 场景1：应用在后台时
1. 打开应用，进入通知测试页面
2. 点击"5秒后通知"按钮
3. **立即按Home键**，让应用进入后台
4. 等待5秒，观察是否有通知弹出

#### 🔸 场景2：应用完全关闭时
1. 完全关闭应用（从后台滑掉）
2. 重新打开应用
3. 进入通知测试页面，点击"5秒后通知"
4. **完全关闭应用**
5. 等待5秒，观察是否有通知弹出

#### 🔸 场景3：锁屏状态
1. 在应用中设置5秒后通知
2. **锁定iPhone屏幕**
3. 等待5秒，观察锁屏上是否显示通知

### 3. 立即测试通知的方法

#### 方法1：使用定时通知（推荐）
```dart
// 在通知测试页面点击"5秒后通知"
// 然后立即让应用进入后台
```

#### 方法2：使用番茄钟通知
```dart
// 设置一个很短的番茄钟时间（如10秒）
// 让应用进入后台
// 等待番茄钟结束时的通知
```

## 🚨 常见问题和解决方案

### 问题1：通知只在应用内显示
**原因**：iOS在应用前台时默认不显示通知横幅
**解决**：测试时让应用进入后台或锁屏状态

### 问题2：完全没有通知
**原因**：通知权限未正确授予
**解决**：
1. 删除应用重新安装
2. 重新授予通知权限
3. 检查iPhone系统设置

### 问题3：有声音但没有横幅
**原因**：横幅样式设置问题
**解决**：iPhone设置 → 通知 → 应用 → 横幅样式 → 选择"持续"

### 问题4：通知延迟或不准时
**原因**：iOS电池优化或后台应用刷新限制
**解决**：iPhone设置 → 电池 → 后台应用刷新 → 开启你的应用

## 🎯 最佳测试流程

1. **第一步**：确认通知权限
   - 打开应用，检查通知测试页面的权限状态
   - 如果显示"需要通知权限"，去系统设置中开启

2. **第二步**：后台测试
   - 点击"5秒后通知"按钮
   - 立即按Home键让应用进入后台
   - 等待通知弹出

3. **第三步**：锁屏测试
   - 重复上述步骤，但锁定屏幕
   - 观察锁屏通知效果

4. **第四步**：番茄钟实际测试
   - 使用番茄钟功能，设置短时间（如1分钟）
   - 让应用进入后台
   - 等待番茄钟结束通知

## 📋 预期效果

✅ **正确的通知效果应该是**：
- 在iPhone顶部显示横幅通知
- 有通知声音（如果开启）
- 通知内容包含标题和描述
- 点击通知可以打开应用
- 在通知中心可以看到历史通知

❌ **不正确的效果**：
- 只在应用内部看到测试成功的提示
- 没有任何弹窗或横幅
- 通知中心没有通知记录

## 🔧 高级排查

如果以上方法都无效，可以尝试：

1. **重新安装应用**：删除应用后重新安装
2. **重启iPhone**：有时iOS通知系统需要重启
3. **检查勿扰模式**：确保iPhone没有开启勿扰模式
4. **检查专注模式**：iOS 15+的专注模式可能影响通知
5. **检查屏幕时间限制**：确保应用没有被屏幕时间限制

## 💡 开发者提示

如果你是开发者，可以在Xcode中查看控制台日志：
```
Window → Devices and Simulators → 选择设备 → Open Console
```
搜索通知相关的日志信息。
